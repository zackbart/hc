---
import { config } from '../config';

const allPosts = await Astro.glob('../pages/blog/*.md');
const recentPosts = allPosts
  .sort((a, b) => new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime())
  .slice(0, 5);

const categories = [...new Set(allPosts.flatMap(post => post.frontmatter.categories || []))];
---

<div class="sidebar-content">
  <!-- Bio Section -->
  <section class="bio-section">
    {config.author.avatar && (
      <div class="avatar-container">
        <img src={config.author.avatar} alt={config.author.name} class="avatar" />
      </div>
    )}
    <h3 class="author-name">{config.author.name}</h3>
    <p class="bio-text">{config.author.bio}</p>
  </section>

  <!-- Recent Posts Section -->
  {recentPosts.length > 0 && (
    <section class="recent-posts">
      <h3 class="section-title">Recent Posts</h3>
      <ul class="post-list">
        {recentPosts.map(post => (
          <li class="post-item">
            <a href={post.url} class="post-link">
              {post.frontmatter.title}
            </a>
            <time class="post-date" datetime={post.frontmatter.date}>
              {new Date(post.frontmatter.date).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
              })}
            </time>
          </li>
        ))}
      </ul>
    </section>
  )}

  <!-- Categories Section -->
  {categories.length > 0 && (
    <section class="categories">
      <h3 class="section-title">Categories</h3>
      <ul class="category-list">
        {categories.map(category => (
          <li class="category-item">
            <a href={`${import.meta.env.BASE_URL}categories/${category.toLowerCase()}`} class="category-link">
              {category}
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}
</div>

<style>
  .sidebar-content {
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-unit) * 4);
    padding: calc(var(--grid-unit) * 3);
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 4px;
  }

  .bio-section {
    text-align: center;
    padding-bottom: calc(var(--grid-unit) * 2);
    border-bottom: 1px solid var(--color-border);
  }

  .avatar-container {
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 2px solid var(--color-border);
    object-fit: cover;
  }

  .author-name {
    font-family: var(--font-heading-secondary);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-accent);
    margin-bottom: calc(var(--grid-unit));
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .bio-text {
    font-size: 0.95rem;
    color: var(--color-text-muted);
    line-height: 1.5;
    margin: 0;
  }

  .section-title {
    font-family: var(--font-heading-secondary);
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-accent);
    margin-bottom: calc(var(--grid-unit) * 1.5);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 2px solid var(--color-accent);
    padding-bottom: calc(var(--grid-unit) / 2);
  }

  .post-list,
  .category-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-unit) * 1.5);
  }

  .post-item {
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-unit) / 2);
  }

  .post-link {
    font-weight: 500;
    line-height: 1.3;
    color: var(--color-text-primary);
  }

  .post-link:hover,
  .post-link:focus {
    color: var(--color-accent);
  }

  .post-date {
    font-size: 0.85rem;
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }

  .category-item {
    display: inline-block;
  }

  .category-link {
    display: inline-block;
    padding: calc(var(--grid-unit) / 2) calc(var(--grid-unit));
    background-color: var(--color-text-primary);
    color: var(--color-background);
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 3px;
    transition: background-color 0.2s ease;
  }

  .category-link:hover,
  .category-link:focus {
    background-color: var(--color-accent);
    text-decoration: none;
  }

  @media (max-width: 1023px) {
    .sidebar-content {
      margin-bottom: calc(var(--grid-unit) * 3);
    }
  }
</style>